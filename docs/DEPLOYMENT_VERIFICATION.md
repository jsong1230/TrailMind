# Vercel 배포 검증 가이드

TrailMind를 Vercel에 배포한 후 프로덕션 환경에서 정상 작동을 확인하는 가이드입니다.

## 📋 배포 전 체크리스트

### 1. 환경 변수 설정 확인

Vercel 대시보드에서 다음 환경 변수가 설정되어 있는지 확인:

- [ ] `OPENAI_API_KEY`: OpenAI API 키 (필수)
- [ ] `OPENAI_MODEL`: 사용할 모델 (선택사항, 기본값: `gpt-4o-mini`)

**확인 방법:**
1. Vercel 대시보드 → 프로젝트 선택
2. Settings → Environment Variables
3. Production, Preview, Development 모두에 설정되어 있는지 확인

### 2. 빌드 성공 확인

- [ ] Vercel 대시보드에서 최신 배포가 성공했는지 확인
- [ ] 빌드 로그에 에러가 없는지 확인

**확인 방법:**
1. Vercel 대시보드 → 프로젝트 선택
2. Deployments 탭에서 최신 배포 확인
3. 배포 클릭하여 빌드 로그 확인

---

## 🧪 배포 후 검증

### 1. 기본 기능 테스트

#### 프론트엔드 기능
- [ ] 홈페이지 로드 확인
- [ ] 반성 입력 기능 작동 확인
- [ ] 로그 보기 기능 작동 확인
- [ ] 검색 기능 작동 확인
- [ ] 주간 인사이트 표시 확인
- [ ] 패턴 인식 페이지 작동 확인
- [ ] 설정 페이지 작동 확인

#### LocalStorage 기능
- [ ] 반성 저장 후 새로고침해도 데이터 유지 확인
- [ ] Export/Import 기능 작동 확인

### 2. AI 기능 검증

#### AI 분석 기능 테스트
1. **반성 항목 생성**
   - 반성하기 페이지에서 텍스트 입력
   - 카테고리 선택 (사고 명확성, 감정 인식, 관계 패턴 중 하나)
   - 저장

2. **AI 분석 실행**
   - 로그 보기에서 생성한 반성 항목 확인
   - "AI로 생성" 버튼 클릭
   - 로딩 상태 확인
   - AI 분석 결과 표시 확인

3. **예상 결과**
   - ✅ AI 분석 결과가 JSON 형식으로 표시됨
   - ✅ 마크다운 형식으로 읽기 좋게 변환되어 표시됨
   - ✅ 모든 필수 필드가 채워져 있음 (특히 "오늘의_질문")
   - ✅ 에러 없이 완료됨

#### AI 기능 에러 케이스 테스트
- [ ] 입력 길이 제한 테스트 (3,000자 초과 시 에러 메시지)
- [ ] 하루 호출 횟수 제한 테스트 (30회 초과 시 에러 메시지)
- [ ] 네트워크 오류 시 에러 메시지 표시 확인
- [ ] 타임아웃 시 에러 메시지 표시 확인

### 3. API 엔드포인트 검증

#### 직접 API 테스트 (선택사항)

브라우저 개발자 도구 콘솔에서:

```javascript
// API 테스트
fetch('/api/generate', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    guideId: '사고_명확성',
    inputText: '오늘 중요한 결정을 내려야 했다. 여러 옵션을 고민했지만 결국 A를 선택했다.',
    meta: {
      date: new Date().toISOString().split('T')[0],
      activity: 'work',
      aloneOrWith: 'alone'
    }
  })
})
  .then(r => r.json())
  .then(data => {
    console.log('API 응답:', data);
    // 확인 사항:
    // - ok: true
    // - result 필드에 모든 필수 필드 포함
    // - 오늘의_질문이 5자 이상
  })
  .catch(err => console.error('API 오류:', err));
```

**예상 응답:**
```json
{
  "ok": true,
  "model": "gpt-4o-mini",
  "createdAt": "2024-01-01T00:00:00.000Z",
  "promptVersion": "1.0.0",
  "result": {
    "핵심_요약": "...",
    "사실과_해석": { "사실": [...], "해석": [...] },
    "감정_신호": [...],
    "관계_신호": [...],
    "재해석": "...",
    "오늘의_질문": "...",
    "아주_작은_행동": "..."
  }
}
```

### 4. 환경 변수 검증

#### 서버 사이드 환경 변수 확인

**중요:** 환경 변수는 클라이언트에서 직접 확인할 수 없습니다. API 호출이 성공하면 환경 변수가 올바르게 설정된 것으로 간주할 수 있습니다.

**확인 방법:**
1. AI 기능이 정상 작동하면 → 환경 변수 정상
2. "서버에 OPENAI_API_KEY가 설정되지 않았습니다" 에러 → 환경 변수 미설정

### 5. 에러 로그 모니터링

#### Vercel 로그 확인

1. **Vercel 대시보드에서 로그 확인**
   - Vercel 대시보드 → 프로젝트 선택
   - Functions 탭 → `/api/generate` 선택
   - Logs 탭에서 실시간 로그 확인

2. **확인할 에러 패턴**
   - ❌ `OPENAI_API_KEY가 설정되지 않았습니다`
   - ❌ `AI 호출 실패 (500)`
   - ❌ `AI 응답 JSON 파싱 실패`
   - ❌ `타임아웃 오류`

3. **정상 작동 시 로그**
   - ✅ `AI 분석 성공`
   - ✅ `200 OK` 응답
   - ✅ 정상적인 JSON 응답

#### 브라우저 콘솔 확인

브라우저 개발자 도구 → Console 탭에서:
- [ ] JavaScript 에러 없음
- [ ] 네트워크 요청 성공 (200 OK)
- [ ] AI 호출 시 에러 없음

---

## 🔍 문제 해결

### 문제 1: AI 기능이 작동하지 않음

**증상:** "AI로 생성" 버튼 클릭 시 에러 발생

**해결 방법:**
1. Vercel 대시보드에서 환경 변수 확인
2. `OPENAI_API_KEY`가 Production 환경에 설정되어 있는지 확인
3. API 키가 유효한지 확인 (OpenAI 대시보드에서 확인)
4. Vercel Functions 로그에서 에러 메시지 확인

### 문제 2: 타임아웃 오류

**증상:** "AI 호출 시간 초과" 에러

**해결 방법:**
1. `vercel.json`에서 `maxDuration` 확인 (현재 30초)
2. 필요 시 더 긴 타임아웃 설정
3. OpenAI API 상태 확인

### 문제 3: 빌드 실패

**증상:** Vercel 배포가 실패함

**해결 방법:**
1. 로컬에서 `npm run build` 실행하여 빌드 에러 확인
2. TypeScript 에러 수정
3. 의존성 문제 확인 (`package.json`)

### 문제 4: 환경 변수가 적용되지 않음

**증상:** 환경 변수를 설정했지만 여전히 에러 발생

**해결 방법:**
1. 환경 변수 설정 후 **재배포** 필요
2. Production, Preview, Development 모두에 설정되어 있는지 확인
3. 환경 변수 이름 오타 확인 (`OPENAI_API_KEY` 정확히)

---

## ✅ 검증 완료 체크리스트

배포 검증이 완료되면 다음을 확인:

- [ ] 모든 기본 기능 정상 작동
- [ ] AI 분석 기능 정상 작동
- [ ] 환경 변수 올바르게 설정됨
- [ ] 에러 로그 없음 (또는 예상된 에러만 발생)
- [ ] 프로덕션 URL에서 모든 기능 테스트 완료
- [ ] 모바일 브라우저에서도 정상 작동 확인 (선택사항)

---

## 📝 검증 결과 기록

배포 검증 후 다음 정보를 기록하세요:

**배포 정보:**
- 배포 날짜: ___________
- 배포 URL: ___________
- 배포 버전/커밋: ___________

**검증 결과:**
- 기본 기능: ✅ / ❌
- AI 기능: ✅ / ❌
- 환경 변수: ✅ / ❌
- 에러 로그: ✅ / ❌

**발견된 문제:**
- 문제 1: ___________
- 해결 방법: ___________

---

## 🔗 관련 문서

- [Vercel 배포 가이드](./VERCEL_DEPLOYMENT.md)
- [로컬 개발 가이드](./LOCAL_DEVELOPMENT.md)
- [AI 통합 가이드](./AI_INTEGRATION.md)

